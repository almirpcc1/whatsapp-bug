<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Business API - Sistema Profissional</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="app-header">
            <div class="app-header-content">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="app-title">
                            <i class="fab fa-whatsapp icon"></i>
                            WhatsApp Business API
                        </h1>
                        <p class="app-subtitle">Sistema profissional de envio em massa com distribuição inteligente</p>
                    </div>
                    <div class="header-actions">
                        <a href="/admin/sent-numbers" class="btn btn-outline-light btn-sm">
                            <i class="fas fa-database"></i>
                            Histórico
                        </a>
                        <button type="button" class="btn btn-outline-light btn-sm" id="testWhatsAppBtn">
                            <i class="fas fa-plug"></i>
                            Testar API
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Grid Layout -->
        <div class="grid grid-cols-12">
            <!-- Connection Panel -->
            <div class="col-span-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-link icon"></i>
                            Conexão WhatsApp Business
                        </h5>
                        <div class="connection-indicator disconnected" id="connectionStatus">
                            <div class="status-dot"></div>
                            Desconectado
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="grid grid-cols-3" id="connectionForm">
                            <div class="col-span-2">
                                <div class="form-group">
                                    <label for="accessToken" class="form-label">Token de Acesso WhatsApp Business</label>
                                    <input type="password" 
                                           class="form-control" 
                                           id="accessToken" 
                                           placeholder="EAAxxxxxxxxxxxxxxxxxx">
                                    <div class="form-text">
                                        <i class="fas fa-info-circle"></i>
                                        Token será usado para descobrir automaticamente Business Manager e Phone Numbers
                                    </div>
                                </div>
                            </div>
                            <div class="col-span-1 flex items-end">
                                <div class="form-group" style="width: 100%;">
                                    <button type="button" class="btn btn-primary" id="connectBtn" style="width: 100%;">
                                        <i class="fas fa-plug"></i>
                                        Conectar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Connection Success State -->
                        <div id="connectionInfo" style="display: none;">
                            <div class="alert alert-success">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-check-circle"></i>
                                        <div>
                                            <div class="font-semibold">Conectado com sucesso</div>
                                            <div class="text-sm">Sistema pronto para envio em massa</div>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-outline btn-sm" onclick="disconnect()">
                                        <i class="fas fa-times"></i>
                                        Desconectar
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Connection Stats -->
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number" id="connectedPhones">-</div>
                                    <div class="stat-label">Phone Numbers</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="connectedTemplates">-</div>
                                    <div class="stat-label">Templates</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="connectedBmId">-</div>
                                    <div class="stat-label">Business Manager</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number success">Online</div>
                                    <div class="stat-label">Status</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuration Panel -->
            <div class="col-span-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-cog icon"></i>
                            Configuração da Campanha
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Phone Selection -->
                        <div class="form-group">
                            <label for="phoneSelect" class="form-label">Phone Number Ativo</label>
                            <select class="form-control" id="phoneSelect" disabled>
                                <option value="">Conecte-se primeiro para carregar números</option>
                            </select>
                            <div class="form-text">
                                <i class="fas fa-info-circle"></i>
                                Selecione o número do WhatsApp para envio das mensagens
                            </div>
                        </div>

                        <!-- Template Selection -->
                        <div class="form-group">
                            <label for="templateSelect" class="form-label">Template Aprovado</label>
                            <select class="form-control" id="templateSelect" disabled>
                                <option value="">Conecte-se primeiro para carregar templates</option>
                            </select>
                            <div class="form-text">
                                <i class="fas fa-info-circle"></i>
                                Apenas templates aprovados pelo WhatsApp Business podem ser usados
                            </div>
                        </div>

                        <!-- Leads Input -->
                        <div class="form-group">
                            <label for="leadsInput" class="form-label">Lista de Contatos</label>
                            <textarea 
                                class="form-control font-monospace" 
                                id="leadsInput" 
                                rows="8"
                                placeholder="5511999887766,João Silva,12345678901&#10;5511998776655,Maria Santos,98765432100&#10;5511997665544,Pedro Costa,11122233344"
                                style="font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace;"
                            ></textarea>
                            <div class="form-text">
                                <i class="fas fa-info-circle"></i>
                                Formato: <code>numero,nome,CPF</code> (um contato por linha)
                            </div>
                        </div>

                        <!-- Validation Button -->
                        <div class="flex gap-3">
                            <button type="button" class="btn btn-primary" id="validateLeadsBtn">
                                <i class="fas fa-check-circle"></i>
                                Validar Lista
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Panel -->
            <div class="col-span-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-chart-line icon"></i>
                            Status da Campanha
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Campaign Stats -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="totalLeadsCount">0</div>
                                <div class="stat-label">Total</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number success" id="validLeadsCount">0</div>
                                <div class="stat-label">Válidos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number error" id="invalidLeadsCount">0</div>
                                <div class="stat-label">Inválidos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number info" id="duplicateLeadsCount">0</div>
                                <div class="stat-label">Duplicatas</div>
                            </div>
                        </div>

                        <!-- Validation Results -->
                        <div id="validationResults" style="display: none;">
                            <div class="alert alert-info">
                                <div class="flex items-start gap-3">
                                    <i class="fas fa-info-circle"></i>
                                    <div>
                                        <div class="font-semibold">Lista validada</div>
                                        <div class="text-sm" id="validationSummary">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Send Button -->
                        <div class="form-group">
                            <button type="button" class="btn btn-success btn-lg" id="smartDistributionBtn" disabled style="width: 100%;">
                                <i class="fas fa-rocket"></i>
                                Iniciar Envio Ultra-Rápido
                            </button>
                        </div>

                        <!-- Progress Section -->
                        <div id="progressSection" style="display: none;">
                            <div class="form-group">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium">Progresso do Envio</span>
                                    <span class="text-sm" id="progressText">0%</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number success" id="sentCount">0</div>
                                    <div class="stat-label">Enviadas</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number error" id="failedCount">0</div>
                                    <div class="stat-label">Falharam</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-2 text-sm">
                                <i class="fas fa-info-circle"></i>
                                <span id="statusMessage">Preparando envio...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Distribution Preview -->
            <div class="col-span-12" id="distributionPreview" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-eye icon"></i>
                            Preview da Distribuição
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="distributionDetails"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>